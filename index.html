<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Weather Dashboard</title>
</head>

<body>
    <p>Weather Dashboard</p>
    <input type="text" id="searchCity"></input>
    <button id="search">Search</button>
    <ul id="current-weather">
    </ul>
    <div id="forecast">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


    <script type="text/javascript">
        var key = "59e42ab69c520d95ac336e9cccb57653";

        function getForecast(forecast) {
            $("#forecast").empty();
            var text = $("<h5>").text("Five Day Forecast");
            $("#forecast").append(text);
            for (i = 1; i <= 5; i++) {
                var day = $("<ul>").text(getDate(forecast[i].dt));
                $("#forecast").append(day);
                var tempMin = $("<li>").text("Temp (min): " + forecast[i].temp.min + "C");
                day.append(tempMin);
                var tempMax = $("<li>").text("Temp (max): " + forecast[i].temp.max + "C");
                day.append(tempMax);
                var humidity = $("<li>").text("Humidity: " + forecast[i].humidity + "%");
                day.append(humidity);
            }
        }


        function getWeather(lat, lon) {
            var queryURL = "https://api.openweathermap.org/data/2.5/onecall?lat=" +
                lat +
                "&lon=" +
                lon +
                "&units=metric&exclude=minutely,hourly&appid=" +
                key;
            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function(response) {
                var tempInCelsius = response.current.temp;
                var temp = $("<li>").text("Temp : " +
                    tempInCelsius.toFixed(1) +
                    "C");
                var humidity = $("<li>").text("Humidity : " + response.current.humidity + "%");
                var windSpeed = $("<li>").text("Wind Speed : " + response.current.wind_speed + " m/s");
                var uvIndex = $("<li>").text("UV Index : " + response.current.uvi);
                $("#current-weather").append(temp);
                $("#current-weather").append(humidity);
                $("#current-weather").append(windSpeed);
                $("#current-weather").append(uvIndex);
                var forecast = response.daily;
                console.log(forecast);
                getForecast(forecast);

            })

        }


        function getDate(date) {
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            date = new Date(1000 * date);
            return date.getDate() + "/" + months[date.getMonth()] + "/" + date.getFullYear();
        }


        function getCoordinates(cityName) {

            var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" +
                cityName +
                "&appid=" +
                key;

            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function(response) {
                    console.log(response);
                    var date = response.dt;
                    date = getDate(date);
                    var cityName = $("<li>").text(response.name + " " + date);
                    $("#current-weather").append(cityName);
                    var cityLat = response.coord.lat;
                    var cityLon = response.coord.lon;
                    getWeather(cityLat, cityLon);
                }

            )
        }

        function searchCity() {

            var cityName = $("#searchCity").val();
            $("#current-weather").empty();
            console.log("I am searching for the weather in this city: " + cityName);

            getCoordinates(cityName);



        }

        $("button").on("click",
            searchCity
        );
    </script>
</body>

</html>